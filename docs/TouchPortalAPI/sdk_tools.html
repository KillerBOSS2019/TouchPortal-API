<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.0.1"/>
    <title>TouchPortalAPI.sdk_tools API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css *//*! pygments syntax highlighting */pre{line-height:125%;}td.linenos pre{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}span.linenos{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}td.linenos pre.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}span.linenos.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}.pdoc .hll{background-color:#ffffcc}.pdoc{background:#f8f8f8;}.pdoc .c{color:#408080; font-style:italic}.pdoc .err{border:1px solid #FF0000}.pdoc .k{color:#008000; font-weight:bold}.pdoc .o{color:#666666}.pdoc .ch{color:#408080; font-style:italic}.pdoc .cm{color:#408080; font-style:italic}.pdoc .cp{color:#BC7A00}.pdoc .cpf{color:#408080; font-style:italic}.pdoc .c1{color:#408080; font-style:italic}.pdoc .cs{color:#408080; font-style:italic}.pdoc .gd{color:#A00000}.pdoc .ge{font-style:italic}.pdoc .gr{color:#FF0000}.pdoc .gh{color:#000080; font-weight:bold}.pdoc .gi{color:#00A000}.pdoc .go{color:#888888}.pdoc .gp{color:#000080; font-weight:bold}.pdoc .gs{font-weight:bold}.pdoc .gu{color:#800080; font-weight:bold}.pdoc .gt{color:#0044DD}.pdoc .kc{color:#008000; font-weight:bold}.pdoc .kd{color:#008000; font-weight:bold}.pdoc .kn{color:#008000; font-weight:bold}.pdoc .kp{color:#008000}.pdoc .kr{color:#008000; font-weight:bold}.pdoc .kt{color:#B00040}.pdoc .m{color:#666666}.pdoc .s{color:#BA2121}.pdoc .na{color:#7D9029}.pdoc .nb{color:#008000}.pdoc .nc{color:#0000FF; font-weight:bold}.pdoc .no{color:#880000}.pdoc .nd{color:#AA22FF}.pdoc .ni{color:#999999; font-weight:bold}.pdoc .ne{color:#D2413A; font-weight:bold}.pdoc .nf{color:#0000FF}.pdoc .nl{color:#A0A000}.pdoc .nn{color:#0000FF; font-weight:bold}.pdoc .nt{color:#008000; font-weight:bold}.pdoc .nv{color:#19177C}.pdoc .ow{color:#AA22FF; font-weight:bold}.pdoc .w{color:#bbbbbb}.pdoc .mb{color:#666666}.pdoc .mf{color:#666666}.pdoc .mh{color:#666666}.pdoc .mi{color:#666666}.pdoc .mo{color:#666666}.pdoc .sa{color:#BA2121}.pdoc .sb{color:#BA2121}.pdoc .sc{color:#BA2121}.pdoc .dl{color:#BA2121}.pdoc .sd{color:#BA2121; font-style:italic}.pdoc .s2{color:#BA2121}.pdoc .se{color:#BB6622; font-weight:bold}.pdoc .sh{color:#BA2121}.pdoc .si{color:#BB6688; font-weight:bold}.pdoc .sx{color:#008000}.pdoc .sr{color:#BB6688}.pdoc .s1{color:#BA2121}.pdoc .ss{color:#19177C}.pdoc .bp{color:#008000}.pdoc .fm{color:#0000FF}.pdoc .vc{color:#19177C}.pdoc .vg{color:#19177C}.pdoc .vi{color:#19177C}.pdoc .vm{color:#19177C}.pdoc .il{color:#666666}@media (prefers-color-scheme:dark){		.pdoc .hll{background-color:#49483e}	.pdoc{background:#272822; color:#f8f8f2}	.pdoc .c{color:#75715e}	.pdoc .err{color:#960050; background-color:#1e0010}	.pdoc .k{color:#66d9ef}	.pdoc .l{color:#ae81ff}	.pdoc .n{color:#f8f8f2}	.pdoc .o{color:#f92672}	.pdoc .p{color:#f8f8f2}	.pdoc .ch{color:#75715e}	.pdoc .cm{color:#75715e}	.pdoc .cp{color:#75715e}	.pdoc .cpf{color:#75715e}	.pdoc .c1{color:#75715e}	.pdoc .cs{color:#75715e}	.pdoc .gd{color:#f92672}	.pdoc .ge{font-style:italic}	.pdoc .gi{color:#a6e22e}	.pdoc .go{color:#66d9ef}	.pdoc .gp{color:#f92672; font-weight:bold}	.pdoc .gs{font-weight:bold}	.pdoc .gu{color:#75715e}	.pdoc .kc{color:#66d9ef}	.pdoc .kd{color:#66d9ef}	.pdoc .kn{color:#f92672}	.pdoc .kp{color:#66d9ef}	.pdoc .kr{color:#66d9ef}	.pdoc .kt{color:#66d9ef}	.pdoc .ld{color:#e6db74}	.pdoc .m{color:#ae81ff}	.pdoc .s{color:#e6db74}	.pdoc .na{color:#a6e22e}	.pdoc .nb{color:#f8f8f2}	.pdoc .nc{color:#a6e22e}	.pdoc .no{color:#66d9ef}	.pdoc .nd{color:#a6e22e}	.pdoc .ni{color:#f8f8f2}	.pdoc .ne{color:#a6e22e}	.pdoc .nf{color:#a6e22e}	.pdoc .nl{color:#f8f8f2}	.pdoc .nn{color:#f8f8f2}	.pdoc .nx{color:#a6e22e}	.pdoc .py{color:#f8f8f2}	.pdoc .nt{color:#f92672}	.pdoc .nv{color:#f8f8f2}	.pdoc .ow{color:#f92672}	.pdoc .w{color:#f8f8f2}	.pdoc .mb{color:#ae81ff}	.pdoc .mf{color:#ae81ff}	.pdoc .mh{color:#ae81ff}	.pdoc .mi{color:#ae81ff}	.pdoc .mo{color:#ae81ff}	.pdoc .sa{color:#e6db74}	.pdoc .sb{color:#e6db74}	.pdoc .sc{color:#e6db74}	.pdoc .dl{color:#e6db74}	.pdoc .sd{color:#e6db74}	.pdoc .s2{color:#e6db74}	.pdoc .se{color:#ae81ff}	.pdoc .sh{color:#e6db74}	.pdoc .si{color:#e6db74}	.pdoc .sx{color:#e6db74}	.pdoc .sr{color:#e6db74}	.pdoc .s1{color:#e6db74}	.pdoc .ss{color:#e6db74}	.pdoc .bp{color:#f8f8f2}	.pdoc .fm{color:#a6e22e}	.pdoc .vc{color:#f8f8f2}	.pdoc .vg{color:#f8f8f2}	.pdoc .vi{color:#f8f8f2}	.pdoc .vm{color:#f8f8f2}	.pdoc .il{color:#ae81ff}}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>@media (prefers-color-scheme:dark){:root{--pdoc-background:#212529;}.pdoc{--text:#f7f7f7;--muted:#9d9d9d;--link:#58a6ff;--link-hover:#3989ff;--code:#333;--active:#555;--accent:#343434;--accent2:#555;--nav-hover:rgba(0, 0, 0, 0.1);--name:#77C1FF;--def:#0cdd0c;--annotation:#00c037;}}
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>.version_header{font-size:.75rem;float:right;margin-top:-3em;margin-right:4em;}nav.pdoc a.inline{display:inline-block;}.module-list-button:not([href$='.html']){display:none !important;}@media (min-width:770px){main, header{width:auto !important;}}@media (max-width:769px){#navtoggle{top:.5rem !important;right:3rem !important;}nav.pdoc input[type=search]{width:calc(100% - 70px - 3rem);}.version_header{float:left;margin-top:-2em;}}
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>.pdoc .attribution{font-size:small;}.pdoc .attribution img{height:25px; width:auto;}
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../TouchPortalAPI.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;TouchPortalAPI</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

        <h2>Contents</h2>
        <ul>
  <li><a href="#touch-portal-python-sdk-tools">Touch Portal Python SDK Tools</a>
  <ul>
    <li><a href="#features">Features</a></li>
    <li><a href="#functions">Functions</a></li>
    <li><a href="#command-line-usage">Command-line Usage</a></li>
    <li><a href="#todoideas">TODO/Ideas</a></li>
  </ul></li>
</ul>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="function" href="#getMessages">getMessages</a>
            </li>
            <li>
                    <a class="function" href="#clearMessages">clearMessages</a>
            </li>
            <li>
                    <a class="function" href="#generateDefinitionFromScript">generateDefinitionFromScript</a>
            </li>
            <li>
                    <a class="function" href="#generateDefinitionFromModule">generateDefinitionFromModule</a>
            </li>
            <li>
                    <a class="function" href="#generateDefinitionFromDeclaration">generateDefinitionFromDeclaration</a>
            </li>
            <li>
                    <a class="function" href="#validateAttribValue">validateAttribValue</a>
            </li>
            <li>
                    <a class="function" href="#validateDefinitionObject">validateDefinitionObject</a>
            </li>
            <li>
                    <a class="function" href="#validateDefinitionString">validateDefinitionString</a>
            </li>
            <li>
                    <a class="function" href="#validateDefinitionFile">validateDefinitionFile</a>
            </li>
            <li>
                    <a class="function" href="#main">main</a>
            </li>
    </ul>


    <footer>Documentation for TouchPortalAPI v1.6.3<br/>generated: 2022-06-05 05:42 UTC<br/>git version: <a href='https://github.com/KillerBOSS2019/TouchPortal-API/commit/93915690' class='inline' target='_blank'>1.6.3-12-g93915690</a><br/></footer>

        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
        <div class="version_header">TouchPortalAPI v1.6.3</div>
<a href="https://github.com/KillerBOSS2019/TouchPortal-API/blob/main/TouchPortalAPI/sdk_tools.py" target="_blank" class="github-corner" title="View the latest source on GitHub" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#3bb300; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true" class="corner-svg">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<style>
    .corner-svg {
        width: 80px;
        height: 80px;
    }
    .github-corner:hover .octo-arm { animation: octocat-wave 560ms ease-in-out }
    @keyframes octocat-wave {
        0%, 100% { transform: rotate(0) }
        20%, 60% { transform: rotate(-25deg) }
        40%, 80% { transform: rotate(10deg) }
    }
    @media (max-width: 769px) {
        .corner-svg {
            width: 50px;
            height: 50px;
        }
    }
</style>                    <h1 class="modulename">
<a href="./../TouchPortalAPI.html">TouchPortalAPI</a><wbr>.sdk_tools    </h1>

                        <div class="docstring"><h1 id="touch-portal-python-sdk-tools">Touch Portal Python SDK Tools</h1>

<h2 id="features">Features</h2>

<p>This SDK tool provides features for generating and validating Touch Portal Plugin Description files,
which are in JSON format and typically named "entry.tp" (as described in the <a href="https://www.touch-portal.com/api/">TP API docs</a>).</p>

<p><strong>Generation</strong> is done based on dictionary structures defined in plugin scripts. These structures closely follow
the format of the description file JSON, but are further expanded to make them also useful within the plugin
scripts themselves. This avoids almost all the need for duplication of things like unique IDs, default values,
settings names, and so on, since those details need to be available in both the definition JSON and in the
script which will be using those definitions to communicate with Touch Portal.</p>

<p><strong>Validation</strong> is performed on the generated descriptions, and can also be run against pre-existing definition files
as a sort of "lint" utility. Currently the following things are checked:</p>

<ul>
<li>All required attributes are present.</li>
<li>All attribute values are of the supported data type(s).</li>
<li>No unknown attributes are present.</li>
<li>Attributes are valid for the TP SDK version being used.</li>
<li>Attribute values fall within allowed list of values (if relevant, eg. <code>Action.type</code>).</li>
<li>All ID strings are unique within the plugin (eg. for States, Actions, etc).</li>
</ul>

<p>This tool can be used as a command-line utility, or imported as a module to use the available functions programmatically.
The script command is <code>tppsdk</code> when the TouchPortalAPI is installed (via pip or setup), or <code>sdk_tool.py</code> when run directly
from this source. To use within a script, simply import in the usual way as needed. For example:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn"><a href="">TouchPortalAPI.sdk_tools</a></span> <span class="kn">import</span> <span class="n">generateDefinitionFromScript</span>
</code></pre></div>

<p>All generation/validation routines are based on TP API specification data tables defined in <code><a href="sdk_spec.html">TouchPortalAPI.sdk_spec</a></code>.</p>

<p>A comprehensive example plugin which utilizes the SDK features is included with the TouchPortalAPI project.
The JSON definition "entry.tp" file for that example could be generated with a simple command from within a local
folder containing the example script:</p>

<pre><code>tppsdk plugin_example.py
</code></pre>

<h2 id="functions">Functions</h2>

<ul>
<li>Generates an <code>entry.tp</code> definition file for a Touch Portal plugin based
on variables specified in the plugin source code (<code><a href="#generateDefinitionFromScript">generateDefinitionFromScript()</a></code>),
from a loaded module (<code><a href="#generateDefinitionFromModule">generateDefinitionFromModule()</a></code>) or specified by value (<code><a href="#generateDefinitionFromDeclaration">generateDefinitionFromDeclaration()</a></code>).</li>
<li>Validate an entire plugin definition (<code>entry.tp</code>) file (<code><a href="#validateDefinitionFile">validateDefinitionFile()</a></code>),
string (<code><a href="#validateDefinitionString">validateDefinitionString()</a></code>), or object (<code><a href="#validateDefinitionObject">validateDefinitionObject()</a></code>).</li>
<li>Validate an <code>entry.tp</code> attribute value against the minimum
SDK version, value type, value content, etc. (<code><a href="#validateAttribValue">validateAttribValue()</a></code>).</li>
</ul>

<h2 id="command-line-usage">Command-line Usage</h2>

<p>The script command is <code>tppsdk</code> when the TouchPortalAPI is installed (via pip or setup), or <code>sdk_tool.py</code> when run directly from this source.</p>

<pre><code>&lt;script_command&gt; [-h] [-g] [-v] [-o &lt;file&gt;] [-s] [-i &lt;n&gt;] [target]

positional arguments:
  target                Either a plugin script for `generate` or an entry.tp file for `validate`. Paths are relative to current working directory.
                        Defaults to './main.py' and './entry.tp' respectively. Use 'stdin' (or '-') to read from input stream instead.

optional arguments:
  -h, --help            show this help message and exit
  -g, --generate        Generate a definition file from plugin script data. This is the default action.
  -v, --validate        Validate a definition JSON file (entry.tp). If given with `generate` then will validate the generated JSON output.

generator arguments:
  -o &lt;file&gt;             Output file for `generate` action. Default will be a file named 'entry.tp' in the same folder as the input script.
                        Paths are relative to current working directory. Use 'stdout' (or '-') to print the output to the console/stream instead.
  -s, --skip-invalid    Skip attributes with invalid values (they will not be included in generated output). Default behavior is to only warn about them.
  -i &lt;n&gt;, --indent &lt;n&gt;  Indent level (spaces) for generated JSON. Use 0 for only newlines, or -1 for the most compact representation. Default is 2 spaces.

This script exits with status code -1 (error) if generation or validation produces warning messages about malformed data.
All progress and warning messages are printed to stderr stream.
</code></pre>

<h2 id="todoideas">TODO/Ideas</h2>

<ul>
<li>Document the default attribute values from sdk_specs table.</li>
<li>Dynamic default values, eg. for action prefix or category id/name (see notes in sdk_spec tables).</li>
<li>Dynamic ID generation and write-back to plugin at runtime.</li>
<li>Allow plugin author to set their own defaults.</li>
</ul>
</div>

                        <input id="sdk_tools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="sdk_tools-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd"># Touch Portal Python SDK Tools</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">## Features</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">This SDK tool provides features for generating and validating Touch Portal Plugin Description files,</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">which are in JSON format and typically named &quot;entry.tp&quot; (as described in the [TP API docs](https://www.touch-portal.com/api/)).</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">**Generation** is done based on dictionary structures defined in plugin scripts. These structures closely follow</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">the format of the description file JSON, but are further expanded to make them also useful within the plugin</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">scripts themselves. This avoids almost all the need for duplication of things like unique IDs, default values,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">settings names, and so on, since those details need to be available in both the definition JSON and in the</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">script which will be using those definitions to communicate with Touch Portal.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">**Validation** is performed on the generated descriptions, and can also be run against pre-existing definition files</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">as a sort of &quot;lint&quot; utility. Currently the following things are checked:</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">- All required attributes are present.</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">- All attribute values are of the supported data type(s).</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">- No unknown attributes are present.</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">- Attributes are valid for the TP SDK version being used.</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">- Attribute values fall within allowed list of values (if relevant, eg. `Action.type`).</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">- All ID strings are unique within the plugin (eg. for States, Actions, etc).</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">This tool can be used as a command-line utility, or imported as a module to use the available functions programmatically.</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">The script command is `tppsdk` when the TouchPortalAPI is installed (via pip or setup), or `sdk_tool.py` when run directly</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">from this source. To use within a script, simply import in the usual way as needed. For example:</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">```py</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">from TouchPortalAPI.sdk_tools import generateDefinitionFromScript</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">```</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">All generation/validation routines are based on TP API specification data tables defined in `TouchPortalAPI.sdk_spec`.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">A comprehensive example plugin which utilizes the SDK features is included with the TouchPortalAPI project.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">The JSON definition &quot;entry.tp&quot; file for that example could be generated with a simple command from within a local</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">folder containing the example script:</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">```</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">tppsdk plugin_example.py</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">```</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">## Functions</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">* Generates an `entry.tp` definition file for a Touch Portal plugin based</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">on variables specified in the plugin source code (`generateDefinitionFromScript()`),</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">from a loaded module (`generateDefinitionFromModule()`) or specified by value (`generateDefinitionFromDeclaration()`).</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">* Validate an entire plugin definition (`entry.tp`) file (`validateDefinitionFile()`),</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">string (`validateDefinitionString()`), or object (`validateDefinitionObject()`).</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">* Validate an `entry.tp` attribute value against the minimum</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">SDK version, value type, value content, etc. (`validateAttribValue()`).</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">## Command-line Usage</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">The script command is `tppsdk` when the TouchPortalAPI is installed (via pip or setup), or `sdk_tool.py` when run directly from this source.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">```</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">&lt;script_command&gt; [-h] [-g] [-v] [-o &lt;file&gt;] [-s] [-i &lt;n&gt;] [target]</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">positional arguments:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">  target                Either a plugin script for `generate` or an entry.tp file for `validate`. Paths are relative to current working directory.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">                        Defaults to &#39;./main.py&#39; and &#39;./entry.tp&#39; respectively. Use &#39;stdin&#39; (or &#39;-&#39;) to read from input stream instead.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">optional arguments:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">  -h, --help            show this help message and exit</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">  -g, --generate        Generate a definition file from plugin script data. This is the default action.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">  -v, --validate        Validate a definition JSON file (entry.tp). If given with `generate` then will validate the generated JSON output.</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">generator arguments:</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">  -o &lt;file&gt;             Output file for `generate` action. Default will be a file named &#39;entry.tp&#39; in the same folder as the input script.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">                        Paths are relative to current working directory. Use &#39;stdout&#39; (or &#39;-&#39;) to print the output to the console/stream instead.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">  -s, --skip-invalid    Skip attributes with invalid values (they will not be included in generated output). Default behavior is to only warn about them.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">  -i &lt;n&gt;, --indent &lt;n&gt;  Indent level (spaces) for generated JSON. Use 0 for only newlines, or -1 for the most compact representation. Default is 2 spaces.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">This script exits with status code -1 (error) if generation or validation produces warning messages about malformed data.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">All progress and warning messages are printed to stderr stream.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">```</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">## TODO/Ideas</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">* Document the default attribute values from sdk_specs table.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">* Dynamic default values, eg. for action prefix or category id/name (see notes in sdk_spec tables).</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">* Dynamic ID generation and write-back to plugin at runtime.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">* Allow plugin author to set their own defaults.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="s2">This file is part of the TouchPortal-API project.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="s2">Copyright TouchPortal-API Developers</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="s2">Copyright (c) 2021 Maxim Paperno</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="s2">All rights reserved.</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="s2">This program is free software: you can redistribute it and/or modify</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="s2">it under the terms of the GNU General Public License as published by</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="s2">the Free Software Foundation, either version 3 of the License, or</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="s2">(at your option) any later version.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="s2">This program is distributed in the hope that it will be useful,</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="s2">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="s2">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="s2">GNU General Public License for more details.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="s2">You should have received a copy of the GNU General Public License</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="s2">along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="kn">import</span> <span class="nn">os.path</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="kn">import</span> <span class="nn">importlib.util</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">ModuleType</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Union</span><span class="p">,</span> <span class="n">TextIO</span><span class="p">)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span> <span class="k">as</span> <span class="n">re_compile</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="kn">from</span> <span class="nn">sdk_spec</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="c1">## globals</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="n">g_messages</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># validation reporting</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="n">g_seen_ids</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># for validating unique IDs</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="c1">## Utils</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="k">def</span> <span class="nf">getMessages</span><span class="p">():</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="sd">&quot;&quot;&quot; Gets a list of messages which may have been produced during generation/validation.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="k">return</span> <span class="n">g_messages</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="k">def</span> <span class="nf">clearMessages</span><span class="p">():</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="sd">&quot;&quot;&quot; Clears the list of validation warning messages.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">    Do this before invoking `validateAttribValue()` directly (outside of the other functions provided here).</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="k">global</span> <span class="n">g_messages</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="n">g_messages</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="k">def</span> <span class="nf">_printMessages</span><span class="p">(</span><span class="n">messages</span><span class="p">:</span><span class="nb">list</span><span class="p">):</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>    <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="n">_printToErr</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="k">def</span> <span class="nf">_addMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>    <span class="k">global</span> <span class="n">g_messages</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>    <span class="n">g_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="k">def</span> <span class="nf">_seenIds</span><span class="p">():</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>    <span class="k">global</span> <span class="n">g_seen_ids</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>    <span class="k">return</span> <span class="n">g_seen_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="k">def</span> <span class="nf">_addSeenId</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>    <span class="k">global</span> <span class="n">g_seen_ids</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>    <span class="n">g_seen_ids</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="k">def</span> <span class="nf">_clearSeenIds</span><span class="p">():</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>    <span class="k">global</span> <span class="n">g_seen_ids</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>    <span class="n">g_seen_ids</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="k">def</span> <span class="nf">_printToErr</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="k">def</span> <span class="nf">_normPath</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="n">path</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">path</span><span class="p">))</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="k">def</span> <span class="nf">_keyPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>    <span class="k">return</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="n">key</span><span class="p">]))</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="c1">## Generator functions</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="k">def</span> <span class="nf">_dictFromItem</span><span class="p">(</span><span class="n">item</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>    <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="c1"># try get explicit value from item</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">:=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>            <span class="c1"># try get default value</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="c1"># check if there is nested data, eg. in an Action</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">_arrayFromDict</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="n">sdk_v</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">_keyPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">skip_invalid</span><span class="o">=</span><span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="c1"># check that the value is valid and add it to the dict if it is</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="n">validateAttribValue</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">skip_invalid</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="n">ret</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>    <span class="k">return</span> <span class="n">ret</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="k">def</span> <span class="nf">_arrayFromDict</span><span class="p">(</span><span class="n">d</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">category</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cat</span> <span class="o">:=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">cat</span> <span class="o">==</span> <span class="n">category</span><span class="p">:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_dictFromItem</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">))</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">,</span><span class="s2">&quot;connectors&quot;</span><span class="p">]:</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="n">_replaceFormatTokens</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>    <span class="k">return</span> <span class="n">ret</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="k">def</span> <span class="nf">_replaceFormatTokens</span><span class="p">(</span><span class="n">items</span><span class="p">:</span><span class="nb">list</span><span class="p">):</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="s1">&#39;format&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="s1">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>            <span class="k">continue</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="n">data_ids</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">):</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">did</span> <span class="o">:=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)):</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>                <span class="n">data_ids</span><span class="p">[</span><span class="n">did</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">did</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_ids</span><span class="p">:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="k">continue</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="n">fmt</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="n">rx</span> <span class="o">=</span> <span class="n">re_compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\$\[(\w+)\]&#39;</span><span class="p">)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="n">begin</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="k">while</span> <span class="p">(</span><span class="n">m</span> <span class="o">:=</span> <span class="n">rx</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">begin</span><span class="p">)):</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">data_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>                <span class="n">val</span> <span class="o">=</span> <span class="n">data_ids</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="k">elif</span> <span class="n">idx</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">:=</span> <span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_ids</span><span class="p">):</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>                <span class="n">val</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ids</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>                <span class="n">begin</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>                <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Could not find replacement for token &#39;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&#39; in &#39;format&#39; attribute for element `</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">`. The data arry does not contain this name/index.&quot;</span><span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>                <span class="k">continue</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="c1"># print(m.span(), val)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">[:</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()]</span> <span class="o">+</span> <span class="s2">&quot;{$&quot;</span> <span class="o">+</span> <span class="n">val</span> <span class="o">+</span> <span class="s2">&quot;$}&quot;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">():]</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="n">begin</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmt</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="k">def</span> <span class="nf">generateDefinitionFromScript</span><span class="p">(</span><span class="n">script</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TextIO</span><span class="p">],</span> <span class="n">skip_invalid</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">    Returns an &quot;entry.tp&quot; Python `dict` which is suitable for direct conversion to JSON format.</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">    `script` should be a valid python script, either a file path (ending in .py), string, or open file handle (like stdin).</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">    The script should contain &quot;SDK declaration variables&quot; like	`TP_PLUGIN_INFO`, `TP_PLUGIN_SETTINGS`, etc.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">    Setting `skip_invalid` to `True` will skip attributes with invalid values (they will not be included in generated output).</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">    Default behavior is to only warn about them.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">    Note that the script is interpreted (executed), so any actual &quot;business&quot; logic (like connecting to TP) should be in &quot;__main__&quot;.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">    Also note that when using input from a file handle or string, the script&#39;s &quot;__file__&quot; attribute is set to the current working</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">    directory and the file name &quot;tp_plugin.py&quot;.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">    May raise an `ImportError` if the plugin script could not be loaded or is missing required variables.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">    Use `getMessages()` to check for any warnings/etc which may be generated (eg. from attribute validation).</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>    <span class="n">script_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">):</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="n">script_str</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="k">elif</span> <span class="ow">not</span> <span class="n">script</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">):</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="n">script_str</span> <span class="o">=</span> <span class="n">script</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="k">if</span> <span class="n">script_str</span><span class="p">:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>            <span class="c1"># load from a string</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_loader</span><span class="p">(</span><span class="s2">&quot;plugin&quot;</span><span class="p">,</span> <span class="n">loader</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="n">plugin</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;__file__&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;tp_plugin.py&quot;</span><span class="p">))</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>            <span class="n">exec</span><span class="p">(</span><span class="n">script_str</span><span class="p">,</span> <span class="n">plugin</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="c1"># load directly from a file path</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="s2">&quot;plugin&quot;</span><span class="p">,</span> <span class="n">script</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">plugin</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="c1"># print(plugin.TP_PLUGIN_INFO)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="n">input_name</span> <span class="o">=</span> <span class="s2">&quot;input stream&quot;</span> <span class="k">if</span> <span class="n">script_str</span> <span class="k">else</span> <span class="n">script</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR while trying to import plugin code from &#39;</span><span class="si">{</span><span class="n">input_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>    <span class="k">return</span> <span class="n">generateDefinitionFromModule</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="k">def</span> <span class="nf">generateDefinitionFromModule</span><span class="p">(</span><span class="n">plugin</span><span class="p">:</span><span class="n">ModuleType</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">    Returns an &quot;entry.tp&quot; Python `dict`, which is suitable for direct conversion to JSON format.</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">    `plugin` should be a loaded Python &quot;module&quot; which contains &quot;SDK declaration variables&quot; like</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">    `TP_PLUGIN_INFO`, `TP_PLUGIN_SETTINGS`, etc. From within a plugin script this could be called like:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">    `generateDefinitionFromModule(sys.modules[__name__])`.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">    Setting `skip_invalid` to `True` will skip attributes with invalid values (they will not be included in generated output).</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">    Default behavior is to only warn about them.</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">    May raise an `ImportError` if the plugin script is missing required variables `TP_PLUGIN_INFO` and `TP_PLUGIN_CATEGORIES`.</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">    Use `getMessages()` to check for any warnings/etc which may be generated (eg. from attribute validation).</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>    <span class="c1"># Load the &quot;standard SDK declaration variables&quot; from plugin script into local scope</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>    <span class="c1"># INFO and CATEGORY are required, rest are optional.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">info</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_INFO&quot;</span><span class="p">,</span> <span class="p">{})):</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Could not import required TP_PLUGIN_INFO variable from plugin source.&quot;</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cats</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_CATEGORIES&quot;</span><span class="p">,</span> <span class="p">{})):</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Could not import required TP_PLUGIN_CATEGORIES variable from plugin source.&quot;</span><span class="p">)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>    <span class="k">return</span> <span class="n">generateDefinitionFromDeclaration</span><span class="p">(</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="n">info</span><span class="p">,</span> <span class="n">cats</span><span class="p">,</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="n">settings</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_SETTINGS&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_ACTIONS&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="n">states</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_STATES&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="n">events</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_EVENTS&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="n">connectors</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_CONNECTORS&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="n">skip_invalid</span> <span class="o">=</span> <span class="n">skip_invalid</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>    <span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="k">def</span> <span class="nf">generateDefinitionFromDeclaration</span><span class="p">(</span><span class="n">info</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">categories</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">    Returns an &quot;entry.tp&quot; Python `dict` which is suitable for direct conversion to JSON format.</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">    Arguments should contain SDK declaration dict values, for example as specified for `TP_PLUGIN_INFO`, etc.</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">    The `info` and `category` values are required, the rest are optional.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">    Setting `skip_invalid` to `True` will skip attributes with invalid values (they will not be included in generated output).</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">    Default behavior is to warn about them but still include them in the output.</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">    `**kwargs` can be one or more of:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">    - settings:dict = {},</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">    - actions:dict = {},</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">    - states:dict = {},</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">    - events:dict = {},</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">    - connectors:dict = {}</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">    Use `getMessages()` to check for any warnings/etc which may be generated (eg. from attribute validation).</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>    <span class="n">_clearSeenIds</span><span class="p">()</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>    <span class="n">clearMessages</span><span class="p">()</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>    <span class="n">settings</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>    <span class="n">actions</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;actions&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>    <span class="n">states</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;states&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>    <span class="n">events</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>    <span class="n">connectors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;connectors&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>    <span class="c1"># print(info, categories, settings, actions, states, events, connectors)</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>    <span class="c1"># Start the root entry.tp object using basic plugin metadata</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>    <span class="c1"># This will also create an empty `categories` array in the root of the entry.</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>    <span class="n">entry</span> <span class="o">=</span> <span class="n">_dictFromItem</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_ROOT</span><span class="p">,</span> <span class="n">TPSDK_DEFAULT_VERSION</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>    <span class="c1"># Get the target SDK version (was either specified in plugin or is TPSDK_DEFAULT_VERSION)</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>    <span class="n">tgt_sdk_v</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;sdk&#39;</span><span class="p">]</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>    <span class="c1"># Loop over each plugin category and set up actions, states, events, and connectors.</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>    <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">categories</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;category[</span><span class="si">{</span><span class="n">cat</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>        <span class="n">category</span> <span class="o">=</span> <span class="n">_dictFromItem</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_CATEGORY</span><span class="p">,</span> <span class="n">tgt_sdk_v</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="n">category</span><span class="p">[</span><span class="s1">&#39;actions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_arrayFromDict</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_ACTION</span><span class="p">,</span> <span class="n">tgt_sdk_v</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="s2">&quot;actions&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="n">category</span><span class="p">[</span><span class="s1">&#39;states&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_arrayFromDict</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_STATE</span><span class="p">,</span> <span class="n">tgt_sdk_v</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="n">category</span><span class="p">[</span><span class="s1">&#39;events&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_arrayFromDict</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_EVENT</span><span class="p">,</span> <span class="n">tgt_sdk_v</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="k">if</span> <span class="n">tgt_sdk_v</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="n">category</span><span class="p">[</span><span class="s1">&#39;connectors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_arrayFromDict</span><span class="p">(</span><span class="n">connectors</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_CONNECTOR</span><span class="p">,</span> <span class="n">tgt_sdk_v</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="s2">&quot;connectors&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="c1"># add the category to entry&#39;s categories array</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;categories&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>    <span class="c1"># Add Settings to root</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>    <span class="k">if</span> <span class="n">tgt_sdk_v</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_arrayFromDict</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_SETTINGS</span><span class="p">,</span> <span class="n">tgt_sdk_v</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;settings&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span> <span class="o">=</span> <span class="n">skip_invalid</span><span class="p">))</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>    <span class="k">return</span> <span class="n">entry</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="c1">## Validation functions</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="k">def</span> <span class="nf">validateAttribValue</span><span class="p">(</span><span class="n">key</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attrib_data</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">    Validates one attribute&#39;s value based on provided lookup table and target SDK version.</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">    Returns `False` if any validation fails or `value` is `None`, `True` otherwise.</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">    Error description message(s) can be retrieved with `getMessages()` and cleared with `clearMessages()`.</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">    Args:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">        `key` is the attribute name;</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">        `value` is what to validate;</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">        `attrib_data` is the lookup table data for the given key (eg. `TPSDK_ATTRIBS_INFO[key]` );</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">        `sdk_v` is the TP SDK version being used (for validation).</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">        `path` is just extra information to print before the key name in warning messages (to show where attribute is in the tree).</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>    <span class="k">global</span> <span class="n">g_seen_ids</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>    <span class="n">keypath</span> <span class="o">=</span> <span class="n">_keyPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="n">attrib_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>            <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Missing required attribute &#39;</span><span class="si">{</span><span class="n">keypath</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">exp_typ</span> <span class="o">:=</span> <span class="n">attrib_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">))):</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Wrong data type for attribute &#39;</span><span class="si">{</span><span class="n">keypath</span><span class="si">}</span><span class="s2">&#39;. Expected </span><span class="si">{</span><span class="n">exp_typ</span><span class="si">}</span><span class="s2"> but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>    <span class="k">if</span> <span class="n">sdk_v</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">min_sdk</span> <span class="o">:=</span> <span class="n">attrib_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">)):</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Wrong SDK version for attribute &#39;</span><span class="si">{</span><span class="n">keypath</span><span class="si">}</span><span class="s2">&#39;. Minimum is v</span><span class="si">{</span><span class="n">min_sdk</span><span class="si">}</span><span class="s2"> but using v</span><span class="si">{</span><span class="n">sdk_v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">choices</span> <span class="o">:=</span> <span class="n">attrib_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">:</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Value error for attribute &#39;</span><span class="si">{</span><span class="n">keypath</span><span class="si">}</span><span class="s2">&#39;. Got &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; but expected one of </span><span class="si">{</span><span class="n">choices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_seenIds</span><span class="p">():</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>            <span class="n">_addSeenId</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keypath</span><span class="p">)</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>            <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: The ID &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; in &#39;</span><span class="si">{</span><span class="n">keypath</span><span class="si">}</span><span class="s2">&#39; is not unique. It was previously seen in &#39;</span><span class="si">{</span><span class="n">g_seen_ids</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="k">def</span> <span class="nf">_validateDefinitionDict</span><span class="p">(</span><span class="n">d</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>    <span class="c1"># iterate over existing attributes to validate them</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="n">adata</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        <span class="n">keypath</span> <span class="o">=</span> <span class="n">_keyPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">adata</span><span class="p">:</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Attribute &#39;</span><span class="si">{</span><span class="n">keypath</span><span class="si">}</span><span class="s2">&#39; is unknown.&quot;</span><span class="p">)</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>            <span class="k">continue</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validateAttribValue</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">adata</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>            <span class="k">continue</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="c1"># print(k, v, type(v))</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ltable</span> <span class="o">:=</span> <span class="n">adata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">)):</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>            <span class="n">_validateDefinitionArray</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ltable</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">,</span> <span class="n">keypath</span><span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>    <span class="c1"># iterate over table entries to check if all required attribs are present</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>            <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Missing required attribute &#39;</span><span class="si">{</span><span class="n">_keyPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="k">def</span> <span class="nf">_validateDefinitionArray</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="n">_validateDefinitionDict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Unable to handle array member &#39;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&#39; in &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="k">def</span> <span class="nf">validateDefinitionObject</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">    Validates a TP plugin definition structure from a Python `dict` object.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">    `data` is a de-serialized entry.tp JSON object (eg. `json.load(&#39;entry.tp&#39;)`)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="sd">    Returns `True` if no problems were found, `False` otherwise.</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">    Use `getMessages()` to check for any validation warnings which may be generated.</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>    <span class="n">_clearSeenIds</span><span class="p">()</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>    <span class="n">clearMessages</span><span class="p">()</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>    <span class="n">sdk_v</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sdk&#39;</span><span class="p">,</span> <span class="n">TPSDK_DEFAULT_VERSION</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>    <span class="n">_validateDefinitionDict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_ROOT</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">g_messages</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="k">def</span> <span class="nf">validateDefinitionString</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">    Validates a TP plugin definition structure from JSON string.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">    `data` is an entry.tp JSON string</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">    Returns `True` if no problems were found, `False` otherwise.</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">    Use `getMessages()` to check for any validation warnings which may be generated.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>    <span class="k">return</span> <span class="n">validateDefinitionObject</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="k">def</span> <span class="nf">validateDefinitionFile</span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TextIO</span><span class="p">]):</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">    Validates a TP plugin definition structure from JSON file.</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">    `file` is a valid system path to an entry.tp JSON file *or* an already-opened file handle (eg. sys.stdin).</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">    Returns `True` if no problems were found, `False` otherwise.</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">    Use `getMessages()` to check for any validation warnings which may be generated.</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>    <span class="n">fh</span> <span class="o">=</span> <span class="n">file</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>    <span class="n">ret</span> <span class="o">=</span> <span class="n">validateDefinitionObject</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">))</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>    <span class="k">if</span> <span class="n">fh</span> <span class="o">!=</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>    <span class="k">return</span> <span class="n">ret</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="c1">## CLI handlers</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="k">def</span> <span class="nf">_generateDefinition</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>    <span class="n">input_name</span> <span class="o">=</span> <span class="s2">&quot;input stream&quot;</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="n">script</span> <span class="o">=</span> <span class="n">script</span> <span class="o">+</span> <span class="s2">&quot;.py&quot;</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="n">input_name</span> <span class="o">=</span> <span class="n">script</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>    <span class="n">indent</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">indent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">indent</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>    <span class="n">_printToErr</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating plugin definition JSON from &#39;</span><span class="si">{</span><span class="n">input_name</span><span class="si">}</span><span class="s2">&#39;...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>    <span class="n">entry</span> <span class="o">=</span> <span class="n">generateDefinitionFromScript</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>    <span class="n">entry_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">messages</span> <span class="o">:=</span> <span class="n">getMessages</span><span class="p">()):</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="n">_printMessages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="n">_printToErr</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>    <span class="c1"># output</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>    <span class="k">if</span> <span class="n">output_path</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>        <span class="c1"># write it to a file</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">entry_file</span><span class="p">:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>            <span class="n">entry_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">entry_str</span><span class="p">)</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="n">_printToErr</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved generated JSON to &#39;</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="c1"># send to stdout</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">entry_str</span><span class="p">)</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>    <span class="n">_printToErr</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished generating plugin definition JSON from &#39;</span><span class="si">{</span><span class="n">input_name</span><span class="si">}</span><span class="s2">&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>    <span class="k">return</span> <span class="n">entry_str</span><span class="p">,</span> <span class="n">valid</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="k">def</span> <span class="nf">_validateDefinition</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">as_str</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">entry</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">as_str</span> <span class="k">else</span> <span class="s2">&quot;input stream&quot;</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>    <span class="n">_printToErr</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validating &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;, any errors or warnings will be printed below...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>    <span class="k">if</span> <span class="n">as_str</span><span class="p">:</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">validateDefinitionString</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">validateDefinitionFile</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>    <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>        <span class="n">_printToErr</span><span class="p">(</span><span class="s2">&quot;No problems found!&quot;</span><span class="p">)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="n">_printMessages</span><span class="p">(</span><span class="n">getMessages</span><span class="p">())</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>    <span class="n">_printToErr</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Finished validating &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>    <span class="k">return</span> <span class="n">res</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>    <span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;This script exits with status code -1 (error) if generation or validation produces warning messages about malformed data. &quot;</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>                                   <span class="s2">&quot;All progress and warning messages are printed to stderr stream.&quot;</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-g&quot;</span><span class="p">,</span> <span class="s2">&quot;--generate&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generate a definition file from plugin script data. This is the default action.&quot;</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--validate&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Validate a definition JSON file (entry.tp). If given with `generate` then will validate the generated JSON output.&quot;</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Either a plugin script for `generate` or an entry.tp file for `validate`. Paths are relative to current working directory. &quot;</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>                             <span class="s2">&quot;Defaults to &#39;./main.py&#39; and &#39;./entry.tp&#39; respectively. Use &#39;stdin&#39; (or &#39;-&#39;) to read from input stream instead. &quot;</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>    <span class="n">gen_grp</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;Generator arguments&quot;</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>    <span class="n">gen_grp</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;&lt;file&gt;&quot;</span><span class="p">,</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>                         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output file for `generate` action. Default will be a file named &#39;entry.tp&#39; in the same folder as the input script. &quot;</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>                           <span class="s2">&quot;Paths are relative to current working directory. Use &#39;stdout&#39; (or &#39;-&#39;) to print the output to the console/stream instead.&quot;</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>    <span class="n">gen_grp</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--skip-invalid&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;skip_invalid&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>                         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Skip attributes with invalid values (they will not be included in generated output). Default behavior is to only warn about them.&quot;</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>    <span class="n">gen_grp</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="s2">&quot;--indent&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;&lt;n&gt;&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>                         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Indent level (spaces) for generated JSON. Use 0 for only newlines, or -1 for the most compact representation. Default is </span><span class="si">%(default)s</span><span class="s2"> spaces.&quot;</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>    <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>    <span class="k">del</span> <span class="n">parser</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>    <span class="c1"># default action</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>    <span class="n">opts</span><span class="o">.</span><span class="n">generate</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">generate</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">validate</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>    <span class="n">_printToErr</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="s2">&quot;stdin&quot;</span><span class="p">):</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>    <span class="n">entry_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">generate</span><span class="p">:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">_normPath</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="ow">or</span> <span class="s2">&quot;main.py&quot;</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>        <span class="n">output_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">o</span><span class="p">:</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>            <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="s2">&quot;stdout&quot;</span><span class="p">):</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>                <span class="n">output_path</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">o</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>            <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>            <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;entry.tp&quot;</span><span class="p">)</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span><span class="p">)))</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>        <span class="n">entry_str</span><span class="p">,</span> <span class="n">valid</span> <span class="o">=</span> <span class="n">_generateDefinition</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">indent</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">validate</span> <span class="ow">and</span> <span class="n">output_path</span><span class="p">:</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">output_path</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">validate</span><span class="p">:</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="k">if</span> <span class="n">entry_str</span><span class="p">:</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>            <span class="n">valid</span> <span class="o">=</span> <span class="n">_validateDefinition</span><span class="p">(</span><span class="n">entry_str</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>            <span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">_normPath</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="ow">or</span> <span class="s2">&quot;entry.tp&quot;</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>            <span class="n">valid</span> <span class="o">=</span> <span class="n">_validateDefinition</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">valid</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></pre></div>


            </section>
                <section id="getMessages">
                            <input id="getMessages-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getMessages</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="getMessages-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#getMessages"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="getMessages-125"><a href="#getMessages-125"><span class="linenos">125</span></a><span class="k">def</span> <span class="nf">getMessages</span><span class="p">():</span>
</span><span id="getMessages-126"><a href="#getMessages-126"><span class="linenos">126</span></a>    <span class="sd">&quot;&quot;&quot; Gets a list of messages which may have been produced during generation/validation.</span>
</span><span id="getMessages-127"><a href="#getMessages-127"><span class="linenos">127</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="getMessages-128"><a href="#getMessages-128"><span class="linenos">128</span></a>    <span class="k">return</span> <span class="n">g_messages</span>
</span></pre></div>


            <div class="docstring"><p>Gets a list of messages which may have been produced during generation/validation.</p>
</div>


                </section>
                <section id="clearMessages">
                            <input id="clearMessages-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clearMessages</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="clearMessages-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#clearMessages"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="clearMessages-130"><a href="#clearMessages-130"><span class="linenos">130</span></a><span class="k">def</span> <span class="nf">clearMessages</span><span class="p">():</span>
</span><span id="clearMessages-131"><a href="#clearMessages-131"><span class="linenos">131</span></a>    <span class="sd">&quot;&quot;&quot; Clears the list of validation warning messages.</span>
</span><span id="clearMessages-132"><a href="#clearMessages-132"><span class="linenos">132</span></a><span class="sd">    Do this before invoking `validateAttribValue()` directly (outside of the other functions provided here).</span>
</span><span id="clearMessages-133"><a href="#clearMessages-133"><span class="linenos">133</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="clearMessages-134"><a href="#clearMessages-134"><span class="linenos">134</span></a>    <span class="k">global</span> <span class="n">g_messages</span>
</span><span id="clearMessages-135"><a href="#clearMessages-135"><span class="linenos">135</span></a>    <span class="n">g_messages</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Clears the list of validation warning messages.
Do this before invoking <code><a href="#validateAttribValue">validateAttribValue()</a></code> directly (outside of the other functions provided here).</p>
</div>


                </section>
                <section id="generateDefinitionFromScript">
                            <input id="generateDefinitionFromScript-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generateDefinitionFromScript</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">script</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TextIO</span><span class="p">]</span>, </span><span class="param"><span class="n">skip_invalid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="generateDefinitionFromScript-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#generateDefinitionFromScript"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="generateDefinitionFromScript-231"><a href="#generateDefinitionFromScript-231"><span class="linenos">231</span></a><span class="k">def</span> <span class="nf">generateDefinitionFromScript</span><span class="p">(</span><span class="n">script</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TextIO</span><span class="p">],</span> <span class="n">skip_invalid</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="generateDefinitionFromScript-232"><a href="#generateDefinitionFromScript-232"><span class="linenos">232</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="generateDefinitionFromScript-233"><a href="#generateDefinitionFromScript-233"><span class="linenos">233</span></a><span class="sd">    Returns an &quot;entry.tp&quot; Python `dict` which is suitable for direct conversion to JSON format.</span>
</span><span id="generateDefinitionFromScript-234"><a href="#generateDefinitionFromScript-234"><span class="linenos">234</span></a>
</span><span id="generateDefinitionFromScript-235"><a href="#generateDefinitionFromScript-235"><span class="linenos">235</span></a><span class="sd">    `script` should be a valid python script, either a file path (ending in .py), string, or open file handle (like stdin).</span>
</span><span id="generateDefinitionFromScript-236"><a href="#generateDefinitionFromScript-236"><span class="linenos">236</span></a><span class="sd">    The script should contain &quot;SDK declaration variables&quot; like	`TP_PLUGIN_INFO`, `TP_PLUGIN_SETTINGS`, etc.</span>
</span><span id="generateDefinitionFromScript-237"><a href="#generateDefinitionFromScript-237"><span class="linenos">237</span></a>
</span><span id="generateDefinitionFromScript-238"><a href="#generateDefinitionFromScript-238"><span class="linenos">238</span></a><span class="sd">    Setting `skip_invalid` to `True` will skip attributes with invalid values (they will not be included in generated output).</span>
</span><span id="generateDefinitionFromScript-239"><a href="#generateDefinitionFromScript-239"><span class="linenos">239</span></a><span class="sd">    Default behavior is to only warn about them.</span>
</span><span id="generateDefinitionFromScript-240"><a href="#generateDefinitionFromScript-240"><span class="linenos">240</span></a>
</span><span id="generateDefinitionFromScript-241"><a href="#generateDefinitionFromScript-241"><span class="linenos">241</span></a><span class="sd">    Note that the script is interpreted (executed), so any actual &quot;business&quot; logic (like connecting to TP) should be in &quot;__main__&quot;.</span>
</span><span id="generateDefinitionFromScript-242"><a href="#generateDefinitionFromScript-242"><span class="linenos">242</span></a><span class="sd">    Also note that when using input from a file handle or string, the script&#39;s &quot;__file__&quot; attribute is set to the current working</span>
</span><span id="generateDefinitionFromScript-243"><a href="#generateDefinitionFromScript-243"><span class="linenos">243</span></a><span class="sd">    directory and the file name &quot;tp_plugin.py&quot;.</span>
</span><span id="generateDefinitionFromScript-244"><a href="#generateDefinitionFromScript-244"><span class="linenos">244</span></a>
</span><span id="generateDefinitionFromScript-245"><a href="#generateDefinitionFromScript-245"><span class="linenos">245</span></a><span class="sd">    May raise an `ImportError` if the plugin script could not be loaded or is missing required variables.</span>
</span><span id="generateDefinitionFromScript-246"><a href="#generateDefinitionFromScript-246"><span class="linenos">246</span></a><span class="sd">    Use `getMessages()` to check for any warnings/etc which may be generated (eg. from attribute validation).</span>
</span><span id="generateDefinitionFromScript-247"><a href="#generateDefinitionFromScript-247"><span class="linenos">247</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="generateDefinitionFromScript-248"><a href="#generateDefinitionFromScript-248"><span class="linenos">248</span></a>    <span class="n">script_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="generateDefinitionFromScript-249"><a href="#generateDefinitionFromScript-249"><span class="linenos">249</span></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">):</span>
</span><span id="generateDefinitionFromScript-250"><a href="#generateDefinitionFromScript-250"><span class="linenos">250</span></a>        <span class="n">script_str</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="generateDefinitionFromScript-251"><a href="#generateDefinitionFromScript-251"><span class="linenos">251</span></a>    <span class="k">elif</span> <span class="ow">not</span> <span class="n">script</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">):</span>
</span><span id="generateDefinitionFromScript-252"><a href="#generateDefinitionFromScript-252"><span class="linenos">252</span></a>        <span class="n">script_str</span> <span class="o">=</span> <span class="n">script</span>
</span><span id="generateDefinitionFromScript-253"><a href="#generateDefinitionFromScript-253"><span class="linenos">253</span></a>
</span><span id="generateDefinitionFromScript-254"><a href="#generateDefinitionFromScript-254"><span class="linenos">254</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="generateDefinitionFromScript-255"><a href="#generateDefinitionFromScript-255"><span class="linenos">255</span></a>        <span class="k">if</span> <span class="n">script_str</span><span class="p">:</span>
</span><span id="generateDefinitionFromScript-256"><a href="#generateDefinitionFromScript-256"><span class="linenos">256</span></a>            <span class="c1"># load from a string</span>
</span><span id="generateDefinitionFromScript-257"><a href="#generateDefinitionFromScript-257"><span class="linenos">257</span></a>            <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_loader</span><span class="p">(</span><span class="s2">&quot;plugin&quot;</span><span class="p">,</span> <span class="n">loader</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="generateDefinitionFromScript-258"><a href="#generateDefinitionFromScript-258"><span class="linenos">258</span></a>            <span class="n">plugin</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</span><span id="generateDefinitionFromScript-259"><a href="#generateDefinitionFromScript-259"><span class="linenos">259</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;__file__&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;tp_plugin.py&quot;</span><span class="p">))</span>
</span><span id="generateDefinitionFromScript-260"><a href="#generateDefinitionFromScript-260"><span class="linenos">260</span></a>            <span class="n">exec</span><span class="p">(</span><span class="n">script_str</span><span class="p">,</span> <span class="n">plugin</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span id="generateDefinitionFromScript-261"><a href="#generateDefinitionFromScript-261"><span class="linenos">261</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="generateDefinitionFromScript-262"><a href="#generateDefinitionFromScript-262"><span class="linenos">262</span></a>            <span class="c1"># load directly from a file path</span>
</span><span id="generateDefinitionFromScript-263"><a href="#generateDefinitionFromScript-263"><span class="linenos">263</span></a>            <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="s2">&quot;plugin&quot;</span><span class="p">,</span> <span class="n">script</span><span class="p">)</span>
</span><span id="generateDefinitionFromScript-264"><a href="#generateDefinitionFromScript-264"><span class="linenos">264</span></a>            <span class="n">plugin</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</span><span id="generateDefinitionFromScript-265"><a href="#generateDefinitionFromScript-265"><span class="linenos">265</span></a>            <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
</span><span id="generateDefinitionFromScript-266"><a href="#generateDefinitionFromScript-266"><span class="linenos">266</span></a>        <span class="c1"># print(plugin.TP_PLUGIN_INFO)</span>
</span><span id="generateDefinitionFromScript-267"><a href="#generateDefinitionFromScript-267"><span class="linenos">267</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="generateDefinitionFromScript-268"><a href="#generateDefinitionFromScript-268"><span class="linenos">268</span></a>        <span class="n">input_name</span> <span class="o">=</span> <span class="s2">&quot;input stream&quot;</span> <span class="k">if</span> <span class="n">script_str</span> <span class="k">else</span> <span class="n">script</span>
</span><span id="generateDefinitionFromScript-269"><a href="#generateDefinitionFromScript-269"><span class="linenos">269</span></a>        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR while trying to import plugin code from &#39;</span><span class="si">{</span><span class="n">input_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="generateDefinitionFromScript-270"><a href="#generateDefinitionFromScript-270"><span class="linenos">270</span></a>    <span class="k">return</span> <span class="n">generateDefinitionFromModule</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns an "entry.tp" Python <code>dict</code> which is suitable for direct conversion to JSON format.</p>

<p><code>script</code> should be a valid python script, either a file path (ending in .py), string, or open file handle (like stdin).
The script should contain "SDK declaration variables" like  <code>TP_PLUGIN_INFO</code>, <code>TP_PLUGIN_SETTINGS</code>, etc.</p>

<p>Setting <code>skip_invalid</code> to <code>True</code> will skip attributes with invalid values (they will not be included in generated output).
Default behavior is to only warn about them.</p>

<p>Note that the script is interpreted (executed), so any actual "business" logic (like connecting to TP) should be in "__main__".
Also note that when using input from a file handle or string, the script's "__file__" attribute is set to the current working
directory and the file name "tp_plugin.py".</p>

<p>May raise an <code>ImportError</code> if the plugin script could not be loaded or is missing required variables.
Use <code><a href="#getMessages">getMessages()</a></code> to check for any warnings/etc which may be generated (eg. from attribute validation).</p>
</div>


                </section>
                <section id="generateDefinitionFromModule">
                            <input id="generateDefinitionFromModule-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generateDefinitionFromModule</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">plugin</span><span class="p">:</span> <span class="n">module</span>, </span><span class="param"><span class="n">skip_invalid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="generateDefinitionFromModule-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#generateDefinitionFromModule"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="generateDefinitionFromModule-273"><a href="#generateDefinitionFromModule-273"><span class="linenos">273</span></a><span class="k">def</span> <span class="nf">generateDefinitionFromModule</span><span class="p">(</span><span class="n">plugin</span><span class="p">:</span><span class="n">ModuleType</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="generateDefinitionFromModule-274"><a href="#generateDefinitionFromModule-274"><span class="linenos">274</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="generateDefinitionFromModule-275"><a href="#generateDefinitionFromModule-275"><span class="linenos">275</span></a><span class="sd">    Returns an &quot;entry.tp&quot; Python `dict`, which is suitable for direct conversion to JSON format.</span>
</span><span id="generateDefinitionFromModule-276"><a href="#generateDefinitionFromModule-276"><span class="linenos">276</span></a><span class="sd">    `plugin` should be a loaded Python &quot;module&quot; which contains &quot;SDK declaration variables&quot; like</span>
</span><span id="generateDefinitionFromModule-277"><a href="#generateDefinitionFromModule-277"><span class="linenos">277</span></a><span class="sd">    `TP_PLUGIN_INFO`, `TP_PLUGIN_SETTINGS`, etc. From within a plugin script this could be called like:</span>
</span><span id="generateDefinitionFromModule-278"><a href="#generateDefinitionFromModule-278"><span class="linenos">278</span></a><span class="sd">    `generateDefinitionFromModule(sys.modules[__name__])`.</span>
</span><span id="generateDefinitionFromModule-279"><a href="#generateDefinitionFromModule-279"><span class="linenos">279</span></a>
</span><span id="generateDefinitionFromModule-280"><a href="#generateDefinitionFromModule-280"><span class="linenos">280</span></a><span class="sd">    Setting `skip_invalid` to `True` will skip attributes with invalid values (they will not be included in generated output).</span>
</span><span id="generateDefinitionFromModule-281"><a href="#generateDefinitionFromModule-281"><span class="linenos">281</span></a><span class="sd">    Default behavior is to only warn about them.</span>
</span><span id="generateDefinitionFromModule-282"><a href="#generateDefinitionFromModule-282"><span class="linenos">282</span></a>
</span><span id="generateDefinitionFromModule-283"><a href="#generateDefinitionFromModule-283"><span class="linenos">283</span></a><span class="sd">    May raise an `ImportError` if the plugin script is missing required variables `TP_PLUGIN_INFO` and `TP_PLUGIN_CATEGORIES`.</span>
</span><span id="generateDefinitionFromModule-284"><a href="#generateDefinitionFromModule-284"><span class="linenos">284</span></a><span class="sd">    Use `getMessages()` to check for any warnings/etc which may be generated (eg. from attribute validation).</span>
</span><span id="generateDefinitionFromModule-285"><a href="#generateDefinitionFromModule-285"><span class="linenos">285</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="generateDefinitionFromModule-286"><a href="#generateDefinitionFromModule-286"><span class="linenos">286</span></a>    <span class="c1"># Load the &quot;standard SDK declaration variables&quot; from plugin script into local scope</span>
</span><span id="generateDefinitionFromModule-287"><a href="#generateDefinitionFromModule-287"><span class="linenos">287</span></a>    <span class="c1"># INFO and CATEGORY are required, rest are optional.</span>
</span><span id="generateDefinitionFromModule-288"><a href="#generateDefinitionFromModule-288"><span class="linenos">288</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">info</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_INFO&quot;</span><span class="p">,</span> <span class="p">{})):</span>
</span><span id="generateDefinitionFromModule-289"><a href="#generateDefinitionFromModule-289"><span class="linenos">289</span></a>        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Could not import required TP_PLUGIN_INFO variable from plugin source.&quot;</span><span class="p">)</span>
</span><span id="generateDefinitionFromModule-290"><a href="#generateDefinitionFromModule-290"><span class="linenos">290</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cats</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_CATEGORIES&quot;</span><span class="p">,</span> <span class="p">{})):</span>
</span><span id="generateDefinitionFromModule-291"><a href="#generateDefinitionFromModule-291"><span class="linenos">291</span></a>        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Could not import required TP_PLUGIN_CATEGORIES variable from plugin source.&quot;</span><span class="p">)</span>
</span><span id="generateDefinitionFromModule-292"><a href="#generateDefinitionFromModule-292"><span class="linenos">292</span></a>    <span class="k">return</span> <span class="n">generateDefinitionFromDeclaration</span><span class="p">(</span>
</span><span id="generateDefinitionFromModule-293"><a href="#generateDefinitionFromModule-293"><span class="linenos">293</span></a>        <span class="n">info</span><span class="p">,</span> <span class="n">cats</span><span class="p">,</span>
</span><span id="generateDefinitionFromModule-294"><a href="#generateDefinitionFromModule-294"><span class="linenos">294</span></a>        <span class="n">settings</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_SETTINGS&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="generateDefinitionFromModule-295"><a href="#generateDefinitionFromModule-295"><span class="linenos">295</span></a>        <span class="n">actions</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_ACTIONS&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="generateDefinitionFromModule-296"><a href="#generateDefinitionFromModule-296"><span class="linenos">296</span></a>        <span class="n">states</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_STATES&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="generateDefinitionFromModule-297"><a href="#generateDefinitionFromModule-297"><span class="linenos">297</span></a>        <span class="n">events</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_EVENTS&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="generateDefinitionFromModule-298"><a href="#generateDefinitionFromModule-298"><span class="linenos">298</span></a>        <span class="n">connectors</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s2">&quot;TP_PLUGIN_CONNECTORS&quot;</span><span class="p">,</span> <span class="p">{}),</span>
</span><span id="generateDefinitionFromModule-299"><a href="#generateDefinitionFromModule-299"><span class="linenos">299</span></a>        <span class="n">skip_invalid</span> <span class="o">=</span> <span class="n">skip_invalid</span>
</span><span id="generateDefinitionFromModule-300"><a href="#generateDefinitionFromModule-300"><span class="linenos">300</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns an "entry.tp" Python <code>dict</code>, which is suitable for direct conversion to JSON format.
<code>plugin</code> should be a loaded Python "module" which contains "SDK declaration variables" like
<code>TP_PLUGIN_INFO</code>, <code>TP_PLUGIN_SETTINGS</code>, etc. From within a plugin script this could be called like:
<code>generateDefinitionFromModule(sys.modules[__name__])</code>.</p>

<p>Setting <code>skip_invalid</code> to <code>True</code> will skip attributes with invalid values (they will not be included in generated output).
Default behavior is to only warn about them.</p>

<p>May raise an <code>ImportError</code> if the plugin script is missing required variables <code>TP_PLUGIN_INFO</code> and <code>TP_PLUGIN_CATEGORIES</code>.
Use <code><a href="#getMessages">getMessages()</a></code> to check for any warnings/etc which may be generated (eg. from attribute validation).</p>
</div>


                </section>
                <section id="generateDefinitionFromDeclaration">
                            <input id="generateDefinitionFromDeclaration-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generateDefinitionFromDeclaration</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">info</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">categories</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">skip_invalid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="generateDefinitionFromDeclaration-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#generateDefinitionFromDeclaration"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="generateDefinitionFromDeclaration-303"><a href="#generateDefinitionFromDeclaration-303"><span class="linenos">303</span></a><span class="k">def</span> <span class="nf">generateDefinitionFromDeclaration</span><span class="p">(</span><span class="n">info</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">categories</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="generateDefinitionFromDeclaration-304"><a href="#generateDefinitionFromDeclaration-304"><span class="linenos">304</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="generateDefinitionFromDeclaration-305"><a href="#generateDefinitionFromDeclaration-305"><span class="linenos">305</span></a><span class="sd">    Returns an &quot;entry.tp&quot; Python `dict` which is suitable for direct conversion to JSON format.</span>
</span><span id="generateDefinitionFromDeclaration-306"><a href="#generateDefinitionFromDeclaration-306"><span class="linenos">306</span></a><span class="sd">    Arguments should contain SDK declaration dict values, for example as specified for `TP_PLUGIN_INFO`, etc.</span>
</span><span id="generateDefinitionFromDeclaration-307"><a href="#generateDefinitionFromDeclaration-307"><span class="linenos">307</span></a>
</span><span id="generateDefinitionFromDeclaration-308"><a href="#generateDefinitionFromDeclaration-308"><span class="linenos">308</span></a><span class="sd">    The `info` and `category` values are required, the rest are optional.</span>
</span><span id="generateDefinitionFromDeclaration-309"><a href="#generateDefinitionFromDeclaration-309"><span class="linenos">309</span></a>
</span><span id="generateDefinitionFromDeclaration-310"><a href="#generateDefinitionFromDeclaration-310"><span class="linenos">310</span></a><span class="sd">    Setting `skip_invalid` to `True` will skip attributes with invalid values (they will not be included in generated output).</span>
</span><span id="generateDefinitionFromDeclaration-311"><a href="#generateDefinitionFromDeclaration-311"><span class="linenos">311</span></a><span class="sd">    Default behavior is to warn about them but still include them in the output.</span>
</span><span id="generateDefinitionFromDeclaration-312"><a href="#generateDefinitionFromDeclaration-312"><span class="linenos">312</span></a>
</span><span id="generateDefinitionFromDeclaration-313"><a href="#generateDefinitionFromDeclaration-313"><span class="linenos">313</span></a><span class="sd">    `**kwargs` can be one or more of:</span>
</span><span id="generateDefinitionFromDeclaration-314"><a href="#generateDefinitionFromDeclaration-314"><span class="linenos">314</span></a><span class="sd">    - settings:dict = {},</span>
</span><span id="generateDefinitionFromDeclaration-315"><a href="#generateDefinitionFromDeclaration-315"><span class="linenos">315</span></a><span class="sd">    - actions:dict = {},</span>
</span><span id="generateDefinitionFromDeclaration-316"><a href="#generateDefinitionFromDeclaration-316"><span class="linenos">316</span></a><span class="sd">    - states:dict = {},</span>
</span><span id="generateDefinitionFromDeclaration-317"><a href="#generateDefinitionFromDeclaration-317"><span class="linenos">317</span></a><span class="sd">    - events:dict = {},</span>
</span><span id="generateDefinitionFromDeclaration-318"><a href="#generateDefinitionFromDeclaration-318"><span class="linenos">318</span></a><span class="sd">    - connectors:dict = {}</span>
</span><span id="generateDefinitionFromDeclaration-319"><a href="#generateDefinitionFromDeclaration-319"><span class="linenos">319</span></a>
</span><span id="generateDefinitionFromDeclaration-320"><a href="#generateDefinitionFromDeclaration-320"><span class="linenos">320</span></a><span class="sd">    Use `getMessages()` to check for any warnings/etc which may be generated (eg. from attribute validation).</span>
</span><span id="generateDefinitionFromDeclaration-321"><a href="#generateDefinitionFromDeclaration-321"><span class="linenos">321</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="generateDefinitionFromDeclaration-322"><a href="#generateDefinitionFromDeclaration-322"><span class="linenos">322</span></a>    <span class="n">_clearSeenIds</span><span class="p">()</span>
</span><span id="generateDefinitionFromDeclaration-323"><a href="#generateDefinitionFromDeclaration-323"><span class="linenos">323</span></a>    <span class="n">clearMessages</span><span class="p">()</span>
</span><span id="generateDefinitionFromDeclaration-324"><a href="#generateDefinitionFromDeclaration-324"><span class="linenos">324</span></a>    <span class="n">settings</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="generateDefinitionFromDeclaration-325"><a href="#generateDefinitionFromDeclaration-325"><span class="linenos">325</span></a>    <span class="n">actions</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;actions&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="generateDefinitionFromDeclaration-326"><a href="#generateDefinitionFromDeclaration-326"><span class="linenos">326</span></a>    <span class="n">states</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;states&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="generateDefinitionFromDeclaration-327"><a href="#generateDefinitionFromDeclaration-327"><span class="linenos">327</span></a>    <span class="n">events</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="generateDefinitionFromDeclaration-328"><a href="#generateDefinitionFromDeclaration-328"><span class="linenos">328</span></a>    <span class="n">connectors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;connectors&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="generateDefinitionFromDeclaration-329"><a href="#generateDefinitionFromDeclaration-329"><span class="linenos">329</span></a>    <span class="c1"># print(info, categories, settings, actions, states, events, connectors)</span>
</span><span id="generateDefinitionFromDeclaration-330"><a href="#generateDefinitionFromDeclaration-330"><span class="linenos">330</span></a>
</span><span id="generateDefinitionFromDeclaration-331"><a href="#generateDefinitionFromDeclaration-331"><span class="linenos">331</span></a>    <span class="c1"># Start the root entry.tp object using basic plugin metadata</span>
</span><span id="generateDefinitionFromDeclaration-332"><a href="#generateDefinitionFromDeclaration-332"><span class="linenos">332</span></a>    <span class="c1"># This will also create an empty `categories` array in the root of the entry.</span>
</span><span id="generateDefinitionFromDeclaration-333"><a href="#generateDefinitionFromDeclaration-333"><span class="linenos">333</span></a>    <span class="n">entry</span> <span class="o">=</span> <span class="n">_dictFromItem</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_ROOT</span><span class="p">,</span> <span class="n">TPSDK_DEFAULT_VERSION</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
</span><span id="generateDefinitionFromDeclaration-334"><a href="#generateDefinitionFromDeclaration-334"><span class="linenos">334</span></a>
</span><span id="generateDefinitionFromDeclaration-335"><a href="#generateDefinitionFromDeclaration-335"><span class="linenos">335</span></a>    <span class="c1"># Get the target SDK version (was either specified in plugin or is TPSDK_DEFAULT_VERSION)</span>
</span><span id="generateDefinitionFromDeclaration-336"><a href="#generateDefinitionFromDeclaration-336"><span class="linenos">336</span></a>    <span class="n">tgt_sdk_v</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;sdk&#39;</span><span class="p">]</span>
</span><span id="generateDefinitionFromDeclaration-337"><a href="#generateDefinitionFromDeclaration-337"><span class="linenos">337</span></a>
</span><span id="generateDefinitionFromDeclaration-338"><a href="#generateDefinitionFromDeclaration-338"><span class="linenos">338</span></a>    <span class="c1"># Loop over each plugin category and set up actions, states, events, and connectors.</span>
</span><span id="generateDefinitionFromDeclaration-339"><a href="#generateDefinitionFromDeclaration-339"><span class="linenos">339</span></a>    <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">categories</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="generateDefinitionFromDeclaration-340"><a href="#generateDefinitionFromDeclaration-340"><span class="linenos">340</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;category[</span><span class="si">{</span><span class="n">cat</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span id="generateDefinitionFromDeclaration-341"><a href="#generateDefinitionFromDeclaration-341"><span class="linenos">341</span></a>        <span class="n">category</span> <span class="o">=</span> <span class="n">_dictFromItem</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_CATEGORY</span><span class="p">,</span> <span class="n">tgt_sdk_v</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="generateDefinitionFromDeclaration-342"><a href="#generateDefinitionFromDeclaration-342"><span class="linenos">342</span></a>        <span class="n">category</span><span class="p">[</span><span class="s1">&#39;actions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_arrayFromDict</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_ACTION</span><span class="p">,</span> <span class="n">tgt_sdk_v</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="s2">&quot;actions&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="generateDefinitionFromDeclaration-343"><a href="#generateDefinitionFromDeclaration-343"><span class="linenos">343</span></a>        <span class="n">category</span><span class="p">[</span><span class="s1">&#39;states&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_arrayFromDict</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_STATE</span><span class="p">,</span> <span class="n">tgt_sdk_v</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="generateDefinitionFromDeclaration-344"><a href="#generateDefinitionFromDeclaration-344"><span class="linenos">344</span></a>        <span class="n">category</span><span class="p">[</span><span class="s1">&#39;events&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_arrayFromDict</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_EVENT</span><span class="p">,</span> <span class="n">tgt_sdk_v</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="generateDefinitionFromDeclaration-345"><a href="#generateDefinitionFromDeclaration-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="n">tgt_sdk_v</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="generateDefinitionFromDeclaration-346"><a href="#generateDefinitionFromDeclaration-346"><span class="linenos">346</span></a>            <span class="n">category</span><span class="p">[</span><span class="s1">&#39;connectors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_arrayFromDict</span><span class="p">(</span><span class="n">connectors</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_CONNECTOR</span><span class="p">,</span> <span class="n">tgt_sdk_v</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="s2">&quot;connectors&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="generateDefinitionFromDeclaration-347"><a href="#generateDefinitionFromDeclaration-347"><span class="linenos">347</span></a>        <span class="c1"># add the category to entry&#39;s categories array</span>
</span><span id="generateDefinitionFromDeclaration-348"><a href="#generateDefinitionFromDeclaration-348"><span class="linenos">348</span></a>        <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;categories&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</span><span id="generateDefinitionFromDeclaration-349"><a href="#generateDefinitionFromDeclaration-349"><span class="linenos">349</span></a>
</span><span id="generateDefinitionFromDeclaration-350"><a href="#generateDefinitionFromDeclaration-350"><span class="linenos">350</span></a>    <span class="c1"># Add Settings to root</span>
</span><span id="generateDefinitionFromDeclaration-351"><a href="#generateDefinitionFromDeclaration-351"><span class="linenos">351</span></a>    <span class="k">if</span> <span class="n">tgt_sdk_v</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="generateDefinitionFromDeclaration-352"><a href="#generateDefinitionFromDeclaration-352"><span class="linenos">352</span></a>        <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_arrayFromDict</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_SETTINGS</span><span class="p">,</span> <span class="n">tgt_sdk_v</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;settings&quot;</span><span class="p">,</span> <span class="n">skip_invalid</span> <span class="o">=</span> <span class="n">skip_invalid</span><span class="p">))</span>
</span><span id="generateDefinitionFromDeclaration-353"><a href="#generateDefinitionFromDeclaration-353"><span class="linenos">353</span></a>
</span><span id="generateDefinitionFromDeclaration-354"><a href="#generateDefinitionFromDeclaration-354"><span class="linenos">354</span></a>    <span class="k">return</span> <span class="n">entry</span>
</span></pre></div>


            <div class="docstring"><p>Returns an "entry.tp" Python <code>dict</code> which is suitable for direct conversion to JSON format.
Arguments should contain SDK declaration dict values, for example as specified for <code>TP_PLUGIN_INFO</code>, etc.</p>

<p>The <code>info</code> and <code>category</code> values are required, the rest are optional.</p>

<p>Setting <code>skip_invalid</code> to <code>True</code> will skip attributes with invalid values (they will not be included in generated output).
Default behavior is to warn about them but still include them in the output.</p>

<p><code>**kwargs</code> can be one or more of:</p>

<ul>
<li>settings:dict = {},</li>
<li>actions:dict = {},</li>
<li>states:dict = {},</li>
<li>events:dict = {},</li>
<li>connectors:dict = {}</li>
</ul>

<p>Use <code><a href="#getMessages">getMessages()</a></code> to check for any warnings/etc which may be generated (eg. from attribute validation).</p>
</div>


                </section>
                <section id="validateAttribValue">
                            <input id="validateAttribValue-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validateAttribValue</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">key</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">value</span>, </span><span class="param"><span class="n">attrib_data</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">sdk_v</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span>)</span>

                <label class="view-source-button" for="validateAttribValue-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validateAttribValue"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validateAttribValue-359"><a href="#validateAttribValue-359"><span class="linenos">359</span></a><span class="k">def</span> <span class="nf">validateAttribValue</span><span class="p">(</span><span class="n">key</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attrib_data</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="validateAttribValue-360"><a href="#validateAttribValue-360"><span class="linenos">360</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="validateAttribValue-361"><a href="#validateAttribValue-361"><span class="linenos">361</span></a><span class="sd">    Validates one attribute&#39;s value based on provided lookup table and target SDK version.</span>
</span><span id="validateAttribValue-362"><a href="#validateAttribValue-362"><span class="linenos">362</span></a><span class="sd">    Returns `False` if any validation fails or `value` is `None`, `True` otherwise.</span>
</span><span id="validateAttribValue-363"><a href="#validateAttribValue-363"><span class="linenos">363</span></a><span class="sd">    Error description message(s) can be retrieved with `getMessages()` and cleared with `clearMessages()`.</span>
</span><span id="validateAttribValue-364"><a href="#validateAttribValue-364"><span class="linenos">364</span></a>
</span><span id="validateAttribValue-365"><a href="#validateAttribValue-365"><span class="linenos">365</span></a><span class="sd">    Args:</span>
</span><span id="validateAttribValue-366"><a href="#validateAttribValue-366"><span class="linenos">366</span></a><span class="sd">        `key` is the attribute name;</span>
</span><span id="validateAttribValue-367"><a href="#validateAttribValue-367"><span class="linenos">367</span></a><span class="sd">        `value` is what to validate;</span>
</span><span id="validateAttribValue-368"><a href="#validateAttribValue-368"><span class="linenos">368</span></a><span class="sd">        `attrib_data` is the lookup table data for the given key (eg. `TPSDK_ATTRIBS_INFO[key]` );</span>
</span><span id="validateAttribValue-369"><a href="#validateAttribValue-369"><span class="linenos">369</span></a><span class="sd">        `sdk_v` is the TP SDK version being used (for validation).</span>
</span><span id="validateAttribValue-370"><a href="#validateAttribValue-370"><span class="linenos">370</span></a><span class="sd">        `path` is just extra information to print before the key name in warning messages (to show where attribute is in the tree).</span>
</span><span id="validateAttribValue-371"><a href="#validateAttribValue-371"><span class="linenos">371</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validateAttribValue-372"><a href="#validateAttribValue-372"><span class="linenos">372</span></a>    <span class="k">global</span> <span class="n">g_seen_ids</span>
</span><span id="validateAttribValue-373"><a href="#validateAttribValue-373"><span class="linenos">373</span></a>    <span class="n">keypath</span> <span class="o">=</span> <span class="n">_keyPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="validateAttribValue-374"><a href="#validateAttribValue-374"><span class="linenos">374</span></a>    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validateAttribValue-375"><a href="#validateAttribValue-375"><span class="linenos">375</span></a>        <span class="k">if</span> <span class="n">attrib_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="validateAttribValue-376"><a href="#validateAttribValue-376"><span class="linenos">376</span></a>            <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Missing required attribute &#39;</span><span class="si">{</span><span class="n">keypath</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
</span><span id="validateAttribValue-377"><a href="#validateAttribValue-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="validateAttribValue-378"><a href="#validateAttribValue-378"><span class="linenos">378</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">exp_typ</span> <span class="o">:=</span> <span class="n">attrib_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">))):</span>
</span><span id="validateAttribValue-379"><a href="#validateAttribValue-379"><span class="linenos">379</span></a>        <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Wrong data type for attribute &#39;</span><span class="si">{</span><span class="n">keypath</span><span class="si">}</span><span class="s2">&#39;. Expected </span><span class="si">{</span><span class="n">exp_typ</span><span class="si">}</span><span class="s2"> but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="validateAttribValue-380"><a href="#validateAttribValue-380"><span class="linenos">380</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="validateAttribValue-381"><a href="#validateAttribValue-381"><span class="linenos">381</span></a>    <span class="k">if</span> <span class="n">sdk_v</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">min_sdk</span> <span class="o">:=</span> <span class="n">attrib_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">)):</span>
</span><span id="validateAttribValue-382"><a href="#validateAttribValue-382"><span class="linenos">382</span></a>        <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Wrong SDK version for attribute &#39;</span><span class="si">{</span><span class="n">keypath</span><span class="si">}</span><span class="s2">&#39;. Minimum is v</span><span class="si">{</span><span class="n">min_sdk</span><span class="si">}</span><span class="s2"> but using v</span><span class="si">{</span><span class="n">sdk_v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="validateAttribValue-383"><a href="#validateAttribValue-383"><span class="linenos">383</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="validateAttribValue-384"><a href="#validateAttribValue-384"><span class="linenos">384</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">choices</span> <span class="o">:=</span> <span class="n">attrib_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">:</span>
</span><span id="validateAttribValue-385"><a href="#validateAttribValue-385"><span class="linenos">385</span></a>        <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Value error for attribute &#39;</span><span class="si">{</span><span class="n">keypath</span><span class="si">}</span><span class="s2">&#39;. Got &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; but expected one of </span><span class="si">{</span><span class="n">choices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="validateAttribValue-386"><a href="#validateAttribValue-386"><span class="linenos">386</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="validateAttribValue-387"><a href="#validateAttribValue-387"><span class="linenos">387</span></a>    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span>
</span><span id="validateAttribValue-388"><a href="#validateAttribValue-388"><span class="linenos">388</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_seenIds</span><span class="p">():</span>
</span><span id="validateAttribValue-389"><a href="#validateAttribValue-389"><span class="linenos">389</span></a>            <span class="n">_addSeenId</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keypath</span><span class="p">)</span>
</span><span id="validateAttribValue-390"><a href="#validateAttribValue-390"><span class="linenos">390</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="validateAttribValue-391"><a href="#validateAttribValue-391"><span class="linenos">391</span></a>            <span class="n">_addMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: The ID &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; in &#39;</span><span class="si">{</span><span class="n">keypath</span><span class="si">}</span><span class="s2">&#39; is not unique. It was previously seen in &#39;</span><span class="si">{</span><span class="n">g_seen_ids</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="validateAttribValue-392"><a href="#validateAttribValue-392"><span class="linenos">392</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="validateAttribValue-393"><a href="#validateAttribValue-393"><span class="linenos">393</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Validates one attribute's value based on provided lookup table and target SDK version.
Returns <code>False</code> if any validation fails or <code>value</code> is <code>None</code>, <code>True</code> otherwise.
Error description message(s) can be retrieved with <code><a href="#getMessages">getMessages()</a></code> and cleared with <code><a href="#clearMessages">clearMessages()</a></code>.</p>

<h6 id="args">Args</h6>

<ul>
<li><code>key</code> is the attribute name;</li>
<li><code>value</code> is what to validate;</li>
<li><code>attrib_data</code> is the lookup table data for the given key (eg. <code>TPSDK_ATTRIBS_INFO[key]</code> );</li>
<li><code>sdk_v</code> is the TP SDK version being used (for validation).</li>
<li><code>path</code> is just extra information to print before the key name in warning messages (to show where attribute is in the tree).</li>
</ul>
</div>


                </section>
                <section id="validateDefinitionObject">
                            <input id="validateDefinitionObject-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validateDefinitionObject</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span></span>)</span>

                <label class="view-source-button" for="validateDefinitionObject-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validateDefinitionObject"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validateDefinitionObject-423"><a href="#validateDefinitionObject-423"><span class="linenos">423</span></a><span class="k">def</span> <span class="nf">validateDefinitionObject</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="validateDefinitionObject-424"><a href="#validateDefinitionObject-424"><span class="linenos">424</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="validateDefinitionObject-425"><a href="#validateDefinitionObject-425"><span class="linenos">425</span></a><span class="sd">    Validates a TP plugin definition structure from a Python `dict` object.</span>
</span><span id="validateDefinitionObject-426"><a href="#validateDefinitionObject-426"><span class="linenos">426</span></a><span class="sd">    `data` is a de-serialized entry.tp JSON object (eg. `json.load(&#39;entry.tp&#39;)`)</span>
</span><span id="validateDefinitionObject-427"><a href="#validateDefinitionObject-427"><span class="linenos">427</span></a><span class="sd">    Returns `True` if no problems were found, `False` otherwise.</span>
</span><span id="validateDefinitionObject-428"><a href="#validateDefinitionObject-428"><span class="linenos">428</span></a><span class="sd">    Use `getMessages()` to check for any validation warnings which may be generated.</span>
</span><span id="validateDefinitionObject-429"><a href="#validateDefinitionObject-429"><span class="linenos">429</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validateDefinitionObject-430"><a href="#validateDefinitionObject-430"><span class="linenos">430</span></a>    <span class="n">_clearSeenIds</span><span class="p">()</span>
</span><span id="validateDefinitionObject-431"><a href="#validateDefinitionObject-431"><span class="linenos">431</span></a>    <span class="n">clearMessages</span><span class="p">()</span>
</span><span id="validateDefinitionObject-432"><a href="#validateDefinitionObject-432"><span class="linenos">432</span></a>    <span class="n">sdk_v</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sdk&#39;</span><span class="p">,</span> <span class="n">TPSDK_DEFAULT_VERSION</span><span class="p">)</span>
</span><span id="validateDefinitionObject-433"><a href="#validateDefinitionObject-433"><span class="linenos">433</span></a>    <span class="n">_validateDefinitionDict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">TPSDK_ATTRIBS_ROOT</span><span class="p">,</span> <span class="n">sdk_v</span><span class="p">)</span>
</span><span id="validateDefinitionObject-434"><a href="#validateDefinitionObject-434"><span class="linenos">434</span></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">g_messages</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>Validates a TP plugin definition structure from a Python <code>dict</code> object.
<code>data</code> is a de-serialized entry.tp JSON object (eg. <code>json.load('entry.tp')</code>)
Returns <code>True</code> if no problems were found, <code>False</code> otherwise.
Use <code><a href="#getMessages">getMessages()</a></code> to check for any validation warnings which may be generated.</p>
</div>


                </section>
                <section id="validateDefinitionString">
                            <input id="validateDefinitionString-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validateDefinitionString</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="validateDefinitionString-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validateDefinitionString"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validateDefinitionString-436"><a href="#validateDefinitionString-436"><span class="linenos">436</span></a><span class="k">def</span> <span class="nf">validateDefinitionString</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
</span><span id="validateDefinitionString-437"><a href="#validateDefinitionString-437"><span class="linenos">437</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="validateDefinitionString-438"><a href="#validateDefinitionString-438"><span class="linenos">438</span></a><span class="sd">    Validates a TP plugin definition structure from JSON string.</span>
</span><span id="validateDefinitionString-439"><a href="#validateDefinitionString-439"><span class="linenos">439</span></a><span class="sd">    `data` is an entry.tp JSON string</span>
</span><span id="validateDefinitionString-440"><a href="#validateDefinitionString-440"><span class="linenos">440</span></a><span class="sd">    Returns `True` if no problems were found, `False` otherwise.</span>
</span><span id="validateDefinitionString-441"><a href="#validateDefinitionString-441"><span class="linenos">441</span></a><span class="sd">    Use `getMessages()` to check for any validation warnings which may be generated.</span>
</span><span id="validateDefinitionString-442"><a href="#validateDefinitionString-442"><span class="linenos">442</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validateDefinitionString-443"><a href="#validateDefinitionString-443"><span class="linenos">443</span></a>    <span class="k">return</span> <span class="n">validateDefinitionObject</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Validates a TP plugin definition structure from JSON string.
<code>data</code> is an entry.tp JSON string
Returns <code>True</code> if no problems were found, <code>False</code> otherwise.
Use <code><a href="#getMessages">getMessages()</a></code> to check for any validation warnings which may be generated.</p>
</div>


                </section>
                <section id="validateDefinitionFile">
                            <input id="validateDefinitionFile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validateDefinitionFile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TextIO</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="validateDefinitionFile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validateDefinitionFile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validateDefinitionFile-445"><a href="#validateDefinitionFile-445"><span class="linenos">445</span></a><span class="k">def</span> <span class="nf">validateDefinitionFile</span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TextIO</span><span class="p">]):</span>
</span><span id="validateDefinitionFile-446"><a href="#validateDefinitionFile-446"><span class="linenos">446</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="validateDefinitionFile-447"><a href="#validateDefinitionFile-447"><span class="linenos">447</span></a><span class="sd">    Validates a TP plugin definition structure from JSON file.</span>
</span><span id="validateDefinitionFile-448"><a href="#validateDefinitionFile-448"><span class="linenos">448</span></a><span class="sd">    `file` is a valid system path to an entry.tp JSON file *or* an already-opened file handle (eg. sys.stdin).</span>
</span><span id="validateDefinitionFile-449"><a href="#validateDefinitionFile-449"><span class="linenos">449</span></a><span class="sd">    Returns `True` if no problems were found, `False` otherwise.</span>
</span><span id="validateDefinitionFile-450"><a href="#validateDefinitionFile-450"><span class="linenos">450</span></a><span class="sd">    Use `getMessages()` to check for any validation warnings which may be generated.</span>
</span><span id="validateDefinitionFile-451"><a href="#validateDefinitionFile-451"><span class="linenos">451</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validateDefinitionFile-452"><a href="#validateDefinitionFile-452"><span class="linenos">452</span></a>    <span class="n">fh</span> <span class="o">=</span> <span class="n">file</span>
</span><span id="validateDefinitionFile-453"><a href="#validateDefinitionFile-453"><span class="linenos">453</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="validateDefinitionFile-454"><a href="#validateDefinitionFile-454"><span class="linenos">454</span></a>        <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="validateDefinitionFile-455"><a href="#validateDefinitionFile-455"><span class="linenos">455</span></a>    <span class="n">ret</span> <span class="o">=</span> <span class="n">validateDefinitionObject</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">))</span>
</span><span id="validateDefinitionFile-456"><a href="#validateDefinitionFile-456"><span class="linenos">456</span></a>    <span class="k">if</span> <span class="n">fh</span> <span class="o">!=</span> <span class="n">file</span><span class="p">:</span>
</span><span id="validateDefinitionFile-457"><a href="#validateDefinitionFile-457"><span class="linenos">457</span></a>        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="validateDefinitionFile-458"><a href="#validateDefinitionFile-458"><span class="linenos">458</span></a>    <span class="k">return</span> <span class="n">ret</span>
</span></pre></div>


            <div class="docstring"><p>Validates a TP plugin definition structure from JSON file.
<code>file</code> is a valid system path to an entry.tp JSON file <em>or</em> an already-opened file handle (eg. sys.stdin).
Returns <code>True</code> if no problems were found, <code>False</code> otherwise.
Use <code><a href="#getMessages">getMessages()</a></code> to check for any validation warnings which may be generated.</p>
</div>


                </section>
                <section id="main">
                            <input id="main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">main</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="main-507"><a href="#main-507"><span class="linenos">507</span></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span id="main-508"><a href="#main-508"><span class="linenos">508</span></a>    <span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
</span><span id="main-509"><a href="#main-509"><span class="linenos">509</span></a>
</span><span id="main-510"><a href="#main-510"><span class="linenos">510</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;This script exits with status code -1 (error) if generation or validation produces warning messages about malformed data. &quot;</span>
</span><span id="main-511"><a href="#main-511"><span class="linenos">511</span></a>                                   <span class="s2">&quot;All progress and warning messages are printed to stderr stream.&quot;</span><span class="p">)</span>
</span><span id="main-512"><a href="#main-512"><span class="linenos">512</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-g&quot;</span><span class="p">,</span> <span class="s2">&quot;--generate&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
</span><span id="main-513"><a href="#main-513"><span class="linenos">513</span></a>                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generate a definition file from plugin script data. This is the default action.&quot;</span><span class="p">)</span>
</span><span id="main-514"><a href="#main-514"><span class="linenos">514</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--validate&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
</span><span id="main-515"><a href="#main-515"><span class="linenos">515</span></a>                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Validate a definition JSON file (entry.tp). If given with `generate` then will validate the generated JSON output.&quot;</span><span class="p">)</span>
</span><span id="main-516"><a href="#main-516"><span class="linenos">516</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="main-517"><a href="#main-517"><span class="linenos">517</span></a>                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Either a plugin script for `generate` or an entry.tp file for `validate`. Paths are relative to current working directory. &quot;</span>
</span><span id="main-518"><a href="#main-518"><span class="linenos">518</span></a>                             <span class="s2">&quot;Defaults to &#39;./main.py&#39; and &#39;./entry.tp&#39; respectively. Use &#39;stdin&#39; (or &#39;-&#39;) to read from input stream instead. &quot;</span><span class="p">)</span>
</span><span id="main-519"><a href="#main-519"><span class="linenos">519</span></a>    <span class="n">gen_grp</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;Generator arguments&quot;</span><span class="p">)</span>
</span><span id="main-520"><a href="#main-520"><span class="linenos">520</span></a>    <span class="n">gen_grp</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;&lt;file&gt;&quot;</span><span class="p">,</span>
</span><span id="main-521"><a href="#main-521"><span class="linenos">521</span></a>                         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output file for `generate` action. Default will be a file named &#39;entry.tp&#39; in the same folder as the input script. &quot;</span>
</span><span id="main-522"><a href="#main-522"><span class="linenos">522</span></a>                           <span class="s2">&quot;Paths are relative to current working directory. Use &#39;stdout&#39; (or &#39;-&#39;) to print the output to the console/stream instead.&quot;</span><span class="p">)</span>
</span><span id="main-523"><a href="#main-523"><span class="linenos">523</span></a>    <span class="n">gen_grp</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--skip-invalid&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;skip_invalid&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="main-524"><a href="#main-524"><span class="linenos">524</span></a>                         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Skip attributes with invalid values (they will not be included in generated output). Default behavior is to only warn about them.&quot;</span><span class="p">)</span>
</span><span id="main-525"><a href="#main-525"><span class="linenos">525</span></a>    <span class="n">gen_grp</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="s2">&quot;--indent&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;&lt;n&gt;&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="main-526"><a href="#main-526"><span class="linenos">526</span></a>                         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Indent level (spaces) for generated JSON. Use 0 for only newlines, or -1 for the most compact representation. Default is </span><span class="si">%(default)s</span><span class="s2"> spaces.&quot;</span><span class="p">)</span>
</span><span id="main-527"><a href="#main-527"><span class="linenos">527</span></a>    <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="main-528"><a href="#main-528"><span class="linenos">528</span></a>    <span class="k">del</span> <span class="n">parser</span>
</span><span id="main-529"><a href="#main-529"><span class="linenos">529</span></a>
</span><span id="main-530"><a href="#main-530"><span class="linenos">530</span></a>    <span class="c1"># default action</span>
</span><span id="main-531"><a href="#main-531"><span class="linenos">531</span></a>    <span class="n">opts</span><span class="o">.</span><span class="n">generate</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">generate</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">validate</span>
</span><span id="main-532"><a href="#main-532"><span class="linenos">532</span></a>
</span><span id="main-533"><a href="#main-533"><span class="linenos">533</span></a>    <span class="n">_printToErr</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="main-534"><a href="#main-534"><span class="linenos">534</span></a>
</span><span id="main-535"><a href="#main-535"><span class="linenos">535</span></a>    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="s2">&quot;stdin&quot;</span><span class="p">):</span>
</span><span id="main-536"><a href="#main-536"><span class="linenos">536</span></a>        <span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
</span><span id="main-537"><a href="#main-537"><span class="linenos">537</span></a>
</span><span id="main-538"><a href="#main-538"><span class="linenos">538</span></a>    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="main-539"><a href="#main-539"><span class="linenos">539</span></a>    <span class="n">entry_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="main-540"><a href="#main-540"><span class="linenos">540</span></a>    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">generate</span><span class="p">:</span>
</span><span id="main-541"><a href="#main-541"><span class="linenos">541</span></a>        <span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">_normPath</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="ow">or</span> <span class="s2">&quot;main.py&quot;</span><span class="p">)</span>
</span><span id="main-542"><a href="#main-542"><span class="linenos">542</span></a>        <span class="n">output_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="main-543"><a href="#main-543"><span class="linenos">543</span></a>        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">o</span><span class="p">:</span>
</span><span id="main-544"><a href="#main-544"><span class="linenos">544</span></a>            <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="s2">&quot;stdout&quot;</span><span class="p">):</span>
</span><span id="main-545"><a href="#main-545"><span class="linenos">545</span></a>                <span class="n">output_path</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">o</span>
</span><span id="main-546"><a href="#main-546"><span class="linenos">546</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="main-547"><a href="#main-547"><span class="linenos">547</span></a>            <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
</span><span id="main-548"><a href="#main-548"><span class="linenos">548</span></a>            <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;entry.tp&quot;</span><span class="p">)</span>
</span><span id="main-549"><a href="#main-549"><span class="linenos">549</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span><span class="p">)))</span>
</span><span id="main-550"><a href="#main-550"><span class="linenos">550</span></a>        <span class="n">entry_str</span><span class="p">,</span> <span class="n">valid</span> <span class="o">=</span> <span class="n">_generateDefinition</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">indent</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">skip_invalid</span><span class="p">)</span>
</span><span id="main-551"><a href="#main-551"><span class="linenos">551</span></a>        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">validate</span> <span class="ow">and</span> <span class="n">output_path</span><span class="p">:</span>
</span><span id="main-552"><a href="#main-552"><span class="linenos">552</span></a>            <span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">output_path</span>
</span><span id="main-553"><a href="#main-553"><span class="linenos">553</span></a>
</span><span id="main-554"><a href="#main-554"><span class="linenos">554</span></a>    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">validate</span><span class="p">:</span>
</span><span id="main-555"><a href="#main-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="n">entry_str</span><span class="p">:</span>
</span><span id="main-556"><a href="#main-556"><span class="linenos">556</span></a>            <span class="n">valid</span> <span class="o">=</span> <span class="n">_validateDefinition</span><span class="p">(</span><span class="n">entry_str</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="main-557"><a href="#main-557"><span class="linenos">557</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="main-558"><a href="#main-558"><span class="linenos">558</span></a>            <span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">_normPath</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span> <span class="ow">or</span> <span class="s2">&quot;entry.tp&quot;</span><span class="p">)</span>
</span><span id="main-559"><a href="#main-559"><span class="linenos">559</span></a>            <span class="n">valid</span> <span class="o">=</span> <span class="n">_validateDefinition</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
</span><span id="main-560"><a href="#main-560"><span class="linenos">560</span></a>
</span><span id="main-561"><a href="#main-561"><span class="linenos">561</span></a>    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">valid</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
</span></pre></div>


    

                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>